<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avisos Meteorológicos IPMA</title>
    <style>
        /* Estilos Base */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
            transition: background-color 0.3s, color 0.3s; /* Transição suave para o tema */
        }
        .container {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 1000px;
            margin: auto;
        }
        h1 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #0056b3;
            margin-top: 40px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
            vertical-align: top;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
            color: #555;
        }
        .alert-level {
            font-weight: bold;
            color: #fff;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
        }
        /* Cores dos alertas */
        .alert-yellow { background-color: #f0c20c; }
        .alert-orange { background-color: #f5870a; }
        .alert-red { background-color: #e02b2b; }
        .alert-green { background-color: #4CAF50; }
        .loading-message {
            text-align: center;
            font-size: 1.2em;
            color: #666;
            padding: 20px;
        }
        .no-warnings {
            text-align: center;
            padding: 15px;
            color: #666;
            font-style: italic;
        }
        /* Estilos para os ícones SVG */
        .awareness-icon {
            margin-right: 8px;
            vertical-align: middle; /* Alinha o ícone com o texto */
            width: 20px; /* Tamanho do ícone */
            height: 20px;
            fill: currentColor; /* Faz com que o ícone herde a cor do texto */
        }
        /* Botão de Tema */
        #themeToggle {
            background-color: #0056b3;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            position: absolute;
            top: 20px;
            right: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s, color 0.3s;
        }
        #themeToggle:hover {
            background-color: #004080;
        }
        /* Ajuste para o botão em ecrãs pequenos */
        @media (max-width: 768px) {
            #themeToggle {
                position: static;
                margin-bottom: 20px;
                display: block;
                width: calc(100% - 40px);
                margin-left: auto;
                margin-right: auto;
            }
            .container {
                padding-top: 20px;
            }
        }

        /* --- Estilos do Tema Escuro --- */
        body.dark-mode {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        body.dark-mode .container {
            background-color: #2b2b2b;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        body.dark-mode h1,
        body.dark-mode h2 {
            color: #90CAF9;
        }
        body.dark-mode h2 {
            border-bottom-color: #444;
        }
        body.dark-mode table {
            border-color: #555;
        }
        body.dark-mode th,
        body.dark-mode td {
            border-color: #555;
        }
        body.dark-mode th {
            background-color: #3a3a3a;
            color: #f0f0f0;
        }
        body.dark-mode .loading-message,
        body.dark-mode .no-warnings {
            color: #b0b0b0;
        }
        body.dark-mode .awareness-icon {
            fill: #e0e0e0; /* Ícones mais claros no tema escuro */
        }
        body.dark-mode #themeToggle {
            background-color: #4CAF50;
            color: #fff;
        }
        body.dark-mode #themeToggle:hover {
            background-color: #45a049;
        }

        /* --- Responsividade das Tabelas --- */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        @media (max-width: 768px) {
            table {
                display: block;
                width: max-content;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button id="themeToggle">Alternar Tema</button>
        <h1>Avisos Meteorológicos IPMA</h1>
        <div id="loading" class="loading-message">A carregar dados dos avisos...</div>
        <div id="errorMessage" class="loading-message" style="display: none; color: red;">Não foi possível carregar os dados dos avisos. Tente novamente mais tarde.</div>
        
        <div id="warningsContent" style="display: none;">
            <h2>Continente</h2>
            <div class="table-responsive">
                <table id="continentTable">
                    <thead>
                        <tr>
                            <th>Área</th>
                            <th>Tipo de Aviso</th>
                            <th>Nível de Alerta</th>
                            <th>Descrição</th>
                            <th>Início</th>
                            <th>Fim</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>

            <h2>Açores</h2>
            <div class="table-responsive">
                <table id="azoresTable">
                    <thead>
                        <tr>
                            <th>Área</th>
                            <th>Tipo de Aviso</th>
                            <th>Nível de Alerta</th>
                            <th>Descrição</th>
                            <th>Início</th>
                            <th>Fim</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>

            <h2>Madeira</h2>
            <div class="table-responsive">
                <table id="madeiraTable">
                    <thead>
                        <tr>
                            <th>Área</th>
                            <th>Tipo de Aviso</th>
                            <th>Nível de Alerta</th>
                            <th>Descrição</th>
                            <th>Início</th>
                            <th>Fim</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://api.ipma.pt/open-data/forecast/warnings/warnings_www.json';
        const loadingMessage = document.getElementById('loading');
        const errorMessage = document.getElementById('errorMessage');
        const warningsContent = document.getElementById('warningsContent'); 
        
        const continentTableBody = document.querySelector('#continentTable tbody');
        const azoresTableBody = document.querySelector('#azoresTable tbody');
        const madeiraTableBody = document.querySelector('#madeiraTable tbody');
        const themeToggle = document.getElementById('themeToggle'); 

        // Objeto para mapear os códigos de área para os nomes dos distritos/regiões E a sua região.
        const areaInfo = {
            // Continente
            "AVE": { name: "Aveiro", region: "Continente" }, "BGC": { name: "Bragança", region: "Continente" },
            "BRG": { name: "Braga", region: "Continente" }, "CBR": { name: "Castelo Branco", region: "Continente" },
            "COI": { name: "Coimbra", region: "Continente" }, "EVR": { name: "Évora", region: "Continente" },
            "FAR": { name: "Faro", region: "Continente" }, "GRD": { name: "Guarda", region: "Continente" },
            "LEI": { name: "Leiria", region: "Continente" }, "LIS": { name: "Lisboa", region: "Continente" },
            "PTL": { name: "Portalegre", region: "Continente" }, "PRT": { name: "Porto", region: "Continente" },
            "STM": { name: "Santarém", region: "Continente" }, "SET": { name: "Setúbal", region: "Continente" },
            "VCB": { name: "Viana do Castelo", region: "Continente" }, "VRL": { name: "Vila Real", region: "Continente" },
            "VIS": { name: "Viseu", region: "Continente" }, "BSJ": { name: "Beja", region: "Continente" },
            "PTO": { name: "Porto", region: "Continente" }, "GDA": { name: "Guarda", region: "Continente" },
            "STB": { name: "Setúbal", region: "Continente" }, "VCT": { name: "Viana do Castelo", region: "Continente" },
            "LSB": { name: "Lisboa", region: "Continente" }, "LRA": { name: "Leiria", region: "Continente" },
            "BJA": { name: "Beja", region: "Continente" }, "CBO": { name: "Castelo Branco", region: "Continente" },
            "AVR": { name: "Aveiro", region: "Continente" }, "PTG": { name: "Portalegre", region: "Continente" },

            // Açores
            "ACZ": { name: "Açores (Grupo Ocidental - Corvo e Flores)", region: "Açores" },
            "ACG": { name: "Açores (Grupo Central - Graciosa, S. Jorge, Pico, Faial, Terceira)", region: "Açores" },
            "ACL": { name: "Açores (Grupo Oriental - S. Miguel e Santa Maria)", region: "Açores" },
            "ACE": { name: "Açores (Grupo Central)", region: "Açores" },
            "AOC": { name: "Açores (Grupo Ocidental)", region: "Açores" },
            "AOR": { name: "Açores (Grupo Oriental)", region: "Açores" },

            // Madeira
            "MDC": { name: "Madeira (Costa Sul)", region: "Madeira" },
            "MDN": { name: "Madeira (Costa Norte)", region: "Madeira" },
            "MPS": { name: "Madeira (Porto Santo)", region: "Madeira" },
            "MDS": { name: "Madeira (Serra)", region: "Madeira" },
            "MRM": { name: "Madeira (Região Montanhosa)", region: "Madeira" },
            "MCS": { name: "Madeira (Costa Sul)", region: "Madeira" },
            "MCN": { name: "Madeira (Costa Norte)", region: "Madeira" }
        };

        // Objeto para mapear tipos de aviso a ÍCONES SVG
        // Pode encontrar mais ícones SVG em sites como:
        // - Heroicons (heroicons.com)
        // - Tabler Icons (tabler-icons.io)
        // - SVG Repo (svgrepo.com)
        const awarenessTypeSVGs = {
            "Tempo Quente": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0V4a1 1 0 0 1 1-1zm6.364 1.636a1 1 0 0 1 0 1.414l-.707.707a1 1 0 0 1-1.414-1.414l.707-.707a1 1 0 0 1 1.414 0zm-12.728 0a1 1 0 0 1 1.414 0l.707.707a1 1 0 0 1-1.414 1.414l-.707-.707a1 1 0 0 1 0-1.414zM19 11a1 1 0 0 1 1 1h1a1 1 0 0 1 0 2h-1a1 1 0 0 1-1-1v-1zm-16 0a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0v-1a1 1 0 0 1 1-1zm16.364 6.364a1 1 0 0 1 0 1.414l-.707.707a1 1 0 0 1-1.414-1.414l.707-.707a1 1 0 0 1 1.414 0zm-12.728 0a1 1 0 0 1 1.414 0l.707.707a1 1 0 0 1-1.414 1.414l-.707-.707a1 1 0 0 1 0-1.414zM12 18a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0v-1a1 1 0 0 1 1-1zm0-10a4 4 0 1 0 0 8 4 4 0 0 0 0-8zm0 2a2 2 0 1 1 0 4 2 2 0 0 1 0-4z"/></svg>',
            "Chuva": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 10h-1.382A5.001 5.001 0 0 0 6 10c0 2.761 2.239 5 5 5h.001c.001 0 .001 0 .001 0 2.761 0 5-2.239 5-5zM12 17v4m-2-2h4m-2 0v-2m-2-2h4m-2 0v-2m-2-2h4m-2 0v-2"/></svg>',
            "Vento": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18zm0-2a7 7 0 1 1 0-14 7 7 0 0 1 0 14zm-1-7h2v-4h-2v4zm0 6h2v-2h-2v2zm0-10h2v-2h-2v2z"/></svg>',
            "Neve": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0V4a1 1 0 0 1 1-1zm6.364 1.636a1 1 0 0 1 0 1.414l-.707.707a1 1 0 0 1-1.414-1.414l.707-.707a1 1 0 0 1 1.414 0zm-12.728 0a1 1 0 0 1 1.414 0l.707.707a1 1 0 0 1-1.414 1.414l-.707-.707a1 1 0 0 1 0-1.414zM19 11a1 1 0 0 1 1 1h1a1 1 0 0 1 0 2h-1a1 1 0 0 1-1-1v-1zm-16 0a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0v-1a1 1 0 0 1 1-1zm16.364 6.364a1 1 0 0 1 0 1.414l-.707.707a1 1 0 0 1-1.414-1.414l.707-.707a1 1 0 0 1 1.414 0zm-12.728 0a1 1 0 0 1 1.414 0l.707.707a1 1 0 0 1-1.414 1.414l-.707-.707a1 1 0 0 1 0-1.414zM12 18a1 1 0 0 1 1 1v1a1 1 0 0 1-2 0v-1a1 1 0 0 1 1-1zm0-10a4 4 0 1 0 0 8 4 4 0 0 0 0-8zm0 2a2 2 0 1 1 0 4 2 2 0 0 1 0-4z"/></svg>',
            "Agitação Marítima": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm-2 4h4v2h-4V8zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z"/></svg>',
            "Trovoada": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 21h4v-3h-4v3zm-3-3h10v-3H7v3zm-3-3h16v-3H4v3zm-1-3h18v-3H3v3zm-1-3h20v-3H2v3z"/></svg>',
            "Nevoeiro": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm-2 4h4v2h-4V8zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z"/></svg>',
            "Radiação UV": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm-2 4h4v2h-4V8zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z"/></svg>',
            "Gelo": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm-2 4h4v2h-4V8zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z"/></svg>',
            "Queda de Neve": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm-2 4h4v2h-4V8zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z"/></svg>',
            "Precipitação": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm-2 4h4v2h-4V8zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z"/></svg>',
            "Vento Forte": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm-2 4h4v2h-4V8zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z"/></svg>',
            "Temperatura Mínima": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm-2 4h4v2h-4V8zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z"/></svg>',
            "Temperatura Máxima": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm-2 4h4v2h-4V8zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z"/></svg>',
            "Descida de Temperatura": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm-2 4h4v2h-4V8zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z"/></svg>',
            "Subida de Temperatura": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm-2 4h4v2h-4V8zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z"/></svg>',
            "Perigo de Incêndio Rural": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm-2 4h4v2h-4V8zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z"/></svg>',
            "Geada": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm-2 4h4v2h-4V8zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z"/></svg>',
            "Tempo Frio": '<svg class="awareness-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8 3.582-8 8-8zm-2 4h4v2h-4V8zm0 4h4v2h-4v-2zm0 4h4v2h-4v-2z"/></svg>'
        };

        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return 'N/A';
            const date = new Date(dateTimeString);
            return date.toLocaleString('pt-PT', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        function getAlertColorClass(levelId) {
            if (!levelId) return '';
            const lowerCaseLevel = levelId.toLowerCase();
            if (lowerCaseLevel === 'green') return 'alert-green';
            if (lowerCaseLevel === 'yellow') return 'alert-yellow';
            if (lowerCaseLevel === 'orange') return 'alert-orange';
            if (lowerCaseLevel === 'red') return 'alert-red';
            return '';
        }

        function translateAlertLevel(levelId) {
            if (!levelId) return 'N/A';
            const lowerCaseLevel = levelId.toLowerCase();
            if (lowerCaseLevel === 'green') return 'Verde';
            if (lowerCaseLevel === 'yellow') return 'Amarelo';
            if (lowerCaseLevel === 'orange') return 'Laranja';
            if (lowerCaseLevel === 'red') return 'Vermelho';
            return levelId;
        }

        // Função auxiliar para adicionar uma linha de aviso a uma tabela específica
        function addWarningRow(tableBody, warning) {
            const row = tableBody.insertRow();
            const alertColorClass = getAlertColorClass(warning.awarenessLevelID);
            const translatedAlertLevel = translateAlertLevel(warning.awarenessLevelID);
            
            const areaCode = warning.idAreaAviso;
            const areaName = areaInfo[areaCode] ? areaInfo[areaCode].name : areaCode || 'N/A';

            let awarenessTypeText = warning.awarenessTypeName || 'N/A';
            const iconSVG = awarenessTypeSVGs[awarenessTypeText]; // Pega o SVG correspondente
            if (iconSVG) {
                // Insere o SVG antes do texto
                awarenessTypeText = `${iconSVG}${awarenessTypeText}`;
            }

            row.insertCell().textContent = areaName;
            row.insertCell().innerHTML = awarenessTypeText; 
            row.insertCell().innerHTML = `<span class="alert-level ${alertColorCl
